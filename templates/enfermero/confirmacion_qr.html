{% extends "base_simple_enfermero.html" %} 
{# AJUSTE CLAVE: Usamos la plantilla minimalista que no tiene sidebar #}

{% block title %}Confirmación de Vinculación{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-success">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="fas fa-check-circle"></i> Vinculación Exitosa</h4>
                </div>
                <div class="card-body">
                    
                    {# Muestra el mensaje flash de éxito que viene de enfermero.py #}
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                {% if category == 'success' %}
                                    <p class="lead">{{ message }}</p>
                                {% else %}
                                    <p class="lead">El paciente ha sido registrado y el QR ha sido vinculado correctamente.</p>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <p class="lead">El paciente ha sido registrado y el QR ha sido vinculado correctamente.</p>
                        {% endif %}
                    {% endwith %}
                    
                    <hr>
                    
                    <h5 class="text-primary mt-4">Instrucciones para el Paciente:</h5>
                    <p>Proporcione la siguiente URL al paciente para que inicie su flujo de autoprueba **sin necesidad de iniciar sesión**.</p>
                    
                    <div class="alert alert-info text-break p-3" role="alert">
                        <strong>URL de Acceso Directo:</strong>
                        <h4 class="mt-2" id="paciente-url">{{ url_completa }}</h4>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <p class="mb-0">
                            <small class="text-muted">ID Paciente: **{{ paciente_id }}** | Código QR: **{{ qr_codigo }}**</small>
                        </p>
                        
                        {# Botón para copiar la URL al portapapeles #}
                        <button class="btn btn-sm btn-outline-primary" onclick="copiarURL()">
                            <i class="fas fa-copy"></i> Copiar URL
                        </button>
                    </div>

                    <hr>
                    
                    <div class="text-center mt-4">
                        {# NOTA: Los enlaces al dashboard o vincular_inicio requerirán login si no lo tienen #}
                        <a href="{{ url_for('enfermero_bp.vincular_inicio') }}" class="btn btn-info">
                            <i class="fas fa-qrcode"></i> Vincular Nuevo QR
                        </a>
                        <a href="{{ url_for('enfermero_bp.dashboard') }}" class="btn btn-secondary me-2">
                            <i class="fas fa-home"></i> Volver al Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function copiarURL() {
        const urlElement = document.getElementById('paciente-url');
        const textToCopy = urlElement.innerText;
        
        // Crea un elemento de texto temporal para copiar
        const tempTextArea = document.createElement('textarea');
        tempTextArea.value = textToCopy;
        document.body.appendChild(tempTextArea);
        
        // Selecciona y copia el texto
        tempTextArea.select();
        document.execCommand('copy');
        
        // Elimina el elemento temporal
        document.body.removeChild(tempTextArea);
        
        // Alerta o feedback visual
        alert("URL copiada al portapapeles: " + textToCopy);
    }
</script>
{% endblock %}