{% extends "base_simple_enfermero.html" %}

{% block title %}Vincular QR y Registrar Paciente{% endblock %}

{% block content %}

{% if error %}
    <div class="alert alert-danger" role="alert">
        <strong>Error de Código QR:</strong> No se puede registrar un paciente con este código.
        <br>Por favor, escanee un código QR **nuevo y sin usar**.
    </div>
{% elif advertencia_vinculado %}
    <div class="alert alert-warning" role="alert">
        <strong>Advertencia:</strong> Este código QR (<strong>{{ codigo_qr }}</strong>) ya se encuentra **vinculado** a un paciente. No se permite un nuevo registro.
    </div>
{% endif %}

    
<div class="dashboard-section card p-4 mb-4">
    <h3 class="card-title">Registrar Paciente y Vincular QR</h3>
   

    <div class="alert alert-info">
        Código QR a Vincular: <strong>{{ codigo_qr }}</strong>
    </div>

    <div class="form-container">
        <form method="POST" action="{{ url_for('enfermero_bp.vincular_con_codigo', codigo=codigo_qr) }}">
            
            <h2>Datos del Paciente</h2>
            
                        <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required 
                   value="{{ form_data.nombre if form_data else '' }}" 
                    {% if advertencia_vinculado or error %}disabled{% endif %}>

            <label for="apellido_paterno">Apellido Paterno:</label>
            <input type="text" id="apellido_paterno" name="apellido_paterno" required
                   value="{{ form_data.apellido_paterno if form_data else '' }}"
                    {% if advertencia_vinculado or error %}disabled{% endif %}>

            <label for="apellido_materno">Apellido Materno:</label>
            <input type="text" id="apellido_materno" name="apellido_materno" 
                   value="{{ form_data.apellido_materno if form_data else '' }}"
                    {% if advertencia_vinculado or error %}disabled{% endif %}>

            <label for="edad">Edad:</label>
            <input type="number" id="edad" name="edad" required min="1" max="120"
                   value="{{ form_data.edad if form_data else '' }}"
                    {% if advertencia_vinculado or error %}disabled{% endif %}>

            <label for="sexo">Sexo:</label>
            <select id="sexo" name="sexo" required {% if advertencia_vinculado or error %}disabled{% endif %}>
                <option value="">Seleccione</option>
                <option value="Masculino" {% if form_data and form_data.sexo == 'Masculino' %}selected{% endif %}>Masculino</option>
                <option value="Femenino" {% if form_data and form_data.sexo == 'Femenino' %}selected{% endif %}>Femenino</option>
                <option value="Otro" {% if form_data and form_data.sexo == 'Otro' %}selected{% endif %}>Otro</option>
            </select>
            
            <label for="telefono">Teléfono:</label>
            <input type="text" id="telefono" name="telefono" 
                   value="{{ form_data.telefono if form_data else '' }}"
                    {% if advertencia_vinculado or error %}disabled{% endif %}>

            <label for="ocupacion">Ocupación:</label>
            <input type="text" id="ocupacion" name="ocupacion" 
                   value="{{ form_data.ocupacion if form_data else '' }}"
                    {% if advertencia_vinculado or error %}disabled{% endif %}>
                    
            <label for="localidad">Localidad:</label>
            <input type="text" id="localidad" name="localidad" 
                   value="{{ form_data.localidad if form_data else '' }}"
                    {% if advertencia_vinculado or error %}disabled{% endif %}>


            <button type="submit" class="btn btn-success" 
                    {% if advertencia_vinculado or error %}disabled{% endif %}>
                Registrar y Vincular
            </button>
        </form>
    </div>

</div>
{% endblock content %}